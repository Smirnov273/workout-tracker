<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢—Ä–µ–∫–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –í–∞–Ω–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
        :root {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            background: #050816;
            color: #f5f5f5;
            display: flex;
            justify-content: center;
        }

        .app {
            width: 100%;
            max-width: 480px;
            min-height: 100vh;
            padding: 16px 12px 24px;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 8px 12px 12px;
            border-radius: 16px;
            background: radial-gradient(circle at top left, #3b82f6 0, #050816 50%);
            margin-bottom: 12px;
        }

        header h1 {
            margin: 0;
            font-size: 20px;
        }

        header p {
            margin: 4px 0 0;
            font-size: 13px;
            opacity: 0.9;
        }

        .date-label {
            margin-top: 6px;
            font-size: 12px;
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .tab-button {
            flex: 1;
            padding: 8px 4px;
            border-radius: 10px;
            border: 0;
            background: #111827;
            color: #e5e7eb;
            font-size: 13px;
            font-weight: 500;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6, #a855f7);
            color: #f9fafb;
        }

        main {
            flex: 1;
            background: #020617;
            border-radius: 16px;
            padding: 12px;
            overflow-y: auto;
        }

        section {
            display: none;
        }

        section.active {
            display: block;
        }

        h2 {
            font-size: 18px;
            margin: 0 0 10px;
        }

        label {
            font-size: 13px;
            display: block;
            margin-bottom: 4px;
        }

        select, input, textarea {
            width: 100%;
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid #1f2937;
            background: #020617;
            color: #f9fafb;
            font-size: 13px;
        }

        textarea {
            min-height: 70px;
            resize: vertical;
        }

        select:focus, input:focus, textarea:focus {
            outline: 1px solid #3b82f6;
        }

        .btn {
            width: 100%;
            padding: 10px;
            border-radius: 12px;
            border: 0;
            margin-top: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #f9fafb;
        }

        .btn-secondary {
            background: #111827;
            color: #e5e7eb;
        }

        .btn-small {
            font-size: 12px;
            padding: 6px 8px;
            width: auto;
        }

        .exercise-list {
            list-style: none;
            padding: 0;
            margin: 8px 0 4px;
        }

        .exercise-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 10px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid #111827;
            margin-bottom: 6px;
        }

        .exercise-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
            font-size: 13px;
        }

        .exercise-meta {
            font-size: 11px;
            opacity: 0.8;
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 8px 0 0;
        }

        .history-item {
            padding: 8px 10px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid #111827;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .history-item-header {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .history-date {
            font-size: 12px;
            opacity: 0.85;
        }

        .history-note {
            margin-top: 4px;
            font-size: 12px;
            opacity: 0.9;
        }

        .chip {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            background: #0f172a;
            font-size: 11px;
            margin-right: 4px;
            margin-top: 3px;
        }

        .muted {
            font-size: 12px;
            opacity: 0.7;
        }

        .block {
            margin-bottom: 12px;
        }

        .row {
            display: flex;
            gap: 8px;
        }

        .row > * {
            flex: 1;
        }

        .tagline {
            font-size: 11px;
            opacity: 0.8;
        }

        .hint {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 4px;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 999px;
            background: #0f172a;
            font-size: 10px;
            margin-left: 6px;
        }

        .empty-state {
            font-size: 13px;
            opacity: 0.8;
            padding: 4px 0;
        }
    </style>
</head>
<body>
<div class="app">
    <header>
        <h1>–¢—Ä–µ–∫–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
        <p>–î–ª—è –í–∞–Ω–∏. –•—Ä–∞–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å, –∞ –Ω–µ –æ—Ç–º–∞–∑–∫–∏ üí™</p>
        <div class="date-label" id="header-date"></div>
    </header>

    <div class="tabs">
        <button class="tab-button active" data-tab="today">–°–µ–≥–æ–¥–Ω—è</button>
        <button class="tab-button" data-tab="programs">–ü—Ä–æ–≥—Ä–∞–º–º—ã</button>
        <button class="tab-button" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
    </div>

    <main>
        <!-- –°–µ–≥–æ–¥–Ω—è -->
        <section id="screen-today" class="active">
            <h2>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è</h2>

            <div class="block">
                <label for="today-workout-select">–í—ã–±–µ—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É</label>
                <select id="today-workout-select"></select>
                <div class="hint">–ü—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–æ–≥—Ä–∞–º–º—ã¬ª.</div>
            </div>

            <div class="block">
                <label>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (–æ—Ç–º–µ—Ç—å, —á—Ç–æ —Å–¥–µ–ª–∞–ª)</label>
                <ul class="exercise-list" id="today-exercise-list"></ul>
            </div>

            <div class="block">
                <label for="today-note">–ó–∞–º–µ—Ç–∫–∞ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ (—Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ, –≤–µ—Å–∞ –∏ —Ç.–ø.)</label>
                <textarea id="today-note" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É–≤–µ–ª–∏—á–∏–ª –≤–µ—Å –≤ –∂–∏–º–µ –ª—ë–∂–∞ –¥–æ 70 –∫–≥"></textarea>
            </div>

            <button class="btn btn-primary" id="btn-save-today">–ó–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
            <div class="hint">–í—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</div>
        </section>

        <!-- –ü—Ä–æ–≥—Ä–∞–º–º—ã -->
        <section id="screen-programs">
            <h2>–ú–æ–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>

            <div class="block">
                <p class="tagline">–°–æ–∑–¥–∞–π —Å–≤–æ–∏ —Å—Ö–µ–º—ã: ¬´–ì—Ä—É–¥—å/—Ç—Ä–∏—Ü–µ–ø—Å¬ª, ¬´–°–ø–∏–Ω–∞/–±–∏—Ü–µ–ø—Å¬ª, ¬´–ù–æ–≥–∏¬ª –∏ —Ç.–¥.</p>
            </div>

            <div class="block">
                <label for="new-workout-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</label>
                <input id="new-workout-name" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—Ä—É–¥—å + —Ç—Ä–∏—Ü–µ–ø—Å">
                <button class="btn btn-secondary" id="btn-add-workout">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</button>
            </div>

            <div class="block">
                <label for="exercise-workout-select">–ö –∫–∞–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –¥–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</label>
                <select id="exercise-workout-select"></select>
            </div>

            <div class="block">
                <label for="exercise-name">–ù–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</label>
                <input id="exercise-name" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–∏–º –ª—ë–∂–∞">
            </div>

            <div class="block row">
                <div>
                    <label for="exercise-sets">–ü–æ–¥—Ö–æ–¥—ã</label>
                    <input id="exercise-sets" type="number" min="1" max="20" value="4">
                </div>
                <div>
                    <label for="exercise-reps">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
                    <input id="exercise-reps" type="number" min="1" max="100" value="8">
                </div>
            </div>

            <button class="btn btn-secondary" id="btn-add-exercise">–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>

            <div class="block">
                <h3 style="font-size:15px;margin:12px 0 6px;">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º</h3>
                <div id="programs-list"></div>
            </div>
        </section>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <section id="screen-history">
            <h2>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
            <p class="tagline">–ß–µ–º –±–æ–ª—å—à–µ —Å—Ç—Ä–æ–∫ –∑–¥–µ—Å—å, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è.</p>
            <ul class="history-list" id="history-list"></ul>
        </section>
    </main>
</div>

<script>
    const STORAGE_KEY = "vanya_workout_tracker_v1";

    const $ = (selector) => document.querySelector(selector);

    let state = {
        workouts: [],
        history: []
    };

    function uuid() {
        return Math.random().toString(36).substring(2, 9) + Date.now().toString(36).substring(5);
    }

    function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
            // –°—Ç–∞—Ä—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            state = {
                workouts: [
                    {
                        id: uuid(),
                        name: "–ì—Ä—É–¥—å + —Ç—Ä–∏—Ü–µ–ø—Å",
                        exercises: [
                            { id: uuid(), name: "–ñ–∏–º –ª—ë–∂–∞", sets: 4, reps: 8 },
                            { id: uuid(), name: "–†–∞–∑–≤–æ–¥–∫–∞ –≥–∞–Ω—Ç–µ–ª–µ–π", sets: 3, reps: 12 },
                            { id: uuid(), name: "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º", sets: 3, reps: 10 }
                        ]
                    },
                    {
                        id: uuid(),
                        name: "–°–ø–∏–Ω–∞ + –±–∏—Ü–µ–ø—Å",
                        exercises: [
                            { id: uuid(), name: "–¢—è–≥–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞", sets: 4, reps: 10 },
                            { id: uuid(), name: "–¢—è–≥–∞ —à—Ç–∞–Ω–≥–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ", sets: 4, reps: 8 },
                            { id: uuid(), name: "–ü–æ–¥—ä—ë–º —à—Ç–∞–Ω–≥–∏ –Ω–∞ –±–∏—Ü–µ–ø—Å", sets: 3, reps: 10 }
                        ]
                    },
                    {
                        id: uuid(),
                        name: "–ù–æ–≥–∏",
                        exercises: [
                            { id: uuid(), name: "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è", sets: 4, reps: 8 },
                            { id: uuid(), name: "–ñ–∏–º –Ω–æ–≥–∞–º–∏", sets: 4, reps: 10 },
                            { id: uuid(), name: "–°–≥–∏–±–∞–Ω–∏–µ –Ω–æ–≥", sets: 3, reps: 12 }
                        ]
                    }
                ],
                history: []
            };
            saveState();
        } else {
            try {
                state = JSON.parse(raw);
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è state, —Å–±—Ä–∞—Å—ã–≤–∞—é", e);
                localStorage.removeItem(STORAGE_KEY);
                loadState();
            }
        }
    }

    function formatDateLabel(date = new Date()) {
        const days = ["–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞"];
        const months = ["—è–Ω–≤–∞—Ä—è", "—Ñ–µ–≤—Ä–∞–ª—è", "–º–∞—Ä—Ç–∞", "–∞–ø—Ä–µ–ª—è", "–º–∞—è", "–∏—é–Ω—è", "–∏—é–ª—è", "–∞–≤–≥—É—Å—Ç–∞", "—Å–µ–Ω—Ç—è–±—Ä—è", "–æ–∫—Ç—è–±—Ä—è", "–Ω–æ—è–±—Ä—è", "–¥–µ–∫–∞–±—Ä—è"];

        const dayName = days[date.getDay()];
        const d = date.getDate();
        const m = months[date.getMonth()];
        const y = date.getFullYear();

        return `${dayName}, ${d} ${m} ${y} –≥.`;
    }

    function todayISO() {
        const d = new Date();
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const dd = String(d.getDate()).padStart(2, "0");
        return `${yyyy}-${mm}-${dd}`;
    }

    function timeHM(date = new Date()) {
        const h = String(date.getHours()).padStart(2, "0");
        const m = String(date.getMinutes()).padStart(2, "0");
        return `${h}:${m}`;
    }

    function setActiveTab(tabId) {
        document.querySelectorAll(".tab-button").forEach(btn => {
            btn.classList.toggle("active", btn.dataset.tab === tabId);
        });
        document.querySelectorAll("main section").forEach(sec => {
            sec.classList.toggle("active", sec.id === "screen-" + tabId);
        });
    }

    function renderWorkoutSelects() {
        const selects = [$("#today-workout-select"), $("#exercise-workout-select")];
        selects.forEach(sel => {
            sel.innerHTML = "";
            state.workouts.forEach(w => {
                const opt = document.createElement("option");
                opt.value = w.id;
                opt.textContent = w.name;
                sel.appendChild(opt);
            });
        });
    }

    function getCurrentTodayWorkoutId() {
        const sel = $("#today-workout-select");
        return sel.value || (state.workouts[0] && state.workouts[0].id) || null;
    }

    function renderTodayExercises() {
        const list = $("#today-exercise-list");
        list.innerHTML = "";

        if (!state.workouts.length) {
            list.innerHTML = `<li class="empty-state">–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–æ–≥—Ä–∞–º–º—ã¬ª.</li>`;
            return;
        }

        const workoutId = getCurrentTodayWorkoutId();
        const workout = state.workouts.find(w => w.id === workoutId);
        if (!workout) return;

        if (!workout.exercises.length) {
            list.innerHTML = `<li class="empty-state">–í —ç—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π. –î–æ–±–∞–≤—å –∏—Ö –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–æ–≥—Ä–∞–º–º—ã¬ª.</li>`;
            return;
        }

        workout.exercises.forEach(ex => {
            const li = document.createElement("li");
            li.className = "exercise-item";
            li.innerHTML = `
                <label>
                    <input type="checkbox" data-exercise-id="${ex.id}">
                    <div>
                        <div>${ex.name}</div>
                        <div class="exercise-meta">${ex.sets} –ø–æ–¥—Ö–æ–¥–æ–≤ √ó ${ex.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div>
                    </div>
                </label>
            `;
            list.appendChild(li);
        });
    }

    function renderProgramsList() {
        const container = $("#programs-list");
        container.innerHTML = "";

        if (!state.workouts.length) {
            container.innerHTML = `<div class="empty-state">–ü—Ä–æ–≥—Ä–∞–º–º –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Å—Ö–µ–º—É –≤—ã—à–µ üëÜ</div>`;
            return;
        }

        state.workouts.forEach(w => {
            const div = document.createElement("div");
            div.className = "history-item";
            const exercisesHtml = w.exercises.length
                ? w.exercises.map(ex => `
                    <div class="chip">${ex.name} ‚Äî ${ex.sets}√ó${ex.reps}</div>
                `).join("")
                : `<div class="muted">–ü–æ–∫–∞ –Ω–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</div>`;

            div.innerHTML = `
                <div class="history-item-header">
                    <span>${w.name}</span>
                    <span class="badge">${w.exercises.length} —É–ø—Ä.</span>
                </div>
                <div>${exercisesHtml}</div>
            `;
            container.appendChild(div);
        });
    }

    function renderHistory() {
        const list = $("#history-list");
        list.innerHTML = "";

        if (!state.history.length) {
            list.innerHTML = `<li class="empty-state">–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞—è. –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É üí™</li>`;
            return;
        }

        const sorted = [...state.history].sort((a, b) => {
            const aKey = a.date + " " + (a.time || "00:00");
            const bKey = b.date + " " + (b.time || "00:00");
            return aKey < bKey ? 1 : -1;
        });

        sorted.forEach(record => {
            const li = document.createElement("li");
            li.className = "history-item";

            const workout = state.workouts.find(w => w.id === record.workoutId);
            const workoutName = workout ? workout.name : "–£–¥–∞–ª—ë–Ω–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞";

            const dateParts = record.date.split("-");
            const prettyDate = `${dateParts[2]}.${dateParts[1]}.${dateParts[0]}`;
            const time = record.time || "--:--";

            const exercises = record.exercises && record.exercises.length
                ? record.exercises.map(name => `<span class="chip">${name}</span>`).join("")
                : `<span class="muted">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–µ –æ—Ç–º–µ—á–µ–Ω—ã</span>`;

            li.innerHTML = `
                <div class="history-item-header">
                    <span>${workoutName}</span>
                    <span class="history-date">${prettyDate}, ${time}</span>
                </div>
                <div>${exercises}</div>
                ${record.note ? `<div class="history-note">–ó–∞–º–µ—Ç–∫–∞: ${record.note}</div>` : ""}
            `;
            list.appendChild(li);
        });
    }

    function addWorkout(name) {
        if (!name.trim()) return;
        state.workouts.push({
            id: uuid(),
            name: name.trim(),
            exercises: []
        });
        saveState();
        renderWorkoutSelects();
        renderProgramsList();
        renderTodayExercises();
    }

    function addExerciseToWorkout(workoutId, name, sets, reps) {
        const workout = state.workouts.find(w => w.id === workoutId);
        if (!workout) return;
        workout.exercises.push({
            id: uuid(),
            name: name.trim(),
            sets: sets,
            reps: reps
        });
        saveState();
        renderProgramsList();
        renderTodayExercises();
    }

    function saveTodayWorkout() {
        if (!state.workouts.length) {
            alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–ü—Ä–æ–≥—Ä–∞–º–º—ã¬ª.");
            return;
        }

        const workoutId = getCurrentTodayWorkoutId();
        const workout = state.workouts.find(w => w.id === workoutId);
        if (!workout) {
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É.");
            return;
        }

        const checked = Array.from(document.querySelectorAll("#today-exercise-list input[type=checkbox]:checked"));
        const doneExerciseNames = checked.map(input => {
            const exId = input.dataset.exerciseId;
            const ex = workout.exercises.find(e => e.id === exId);
            return ex ? ex.name : null;
        }).filter(Boolean);

        const note = $("#today-note").value.trim();
        const now = new Date();

        if (doneExerciseNames.length === 0 && !note) {
            if (!confirm("–¢—ã –Ω–µ –æ—Ç–º–µ—Ç–∏–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª –∑–∞–º–µ—Ç–∫—É. –í—Å—ë —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É?")) {
                return;
            }
        }

        state.history.push({
            id: uuid(),
            date: todayISO(),
            time: timeHM(now),
            workoutId: workoutId,
            exercises: doneExerciseNames,
            note: note
        });

        saveState();
        $("#today-note").value = "";
        document.querySelectorAll("#today-exercise-list input[type=checkbox]").forEach(ch => ch.checked = false);
        renderHistory();
        alert("–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! –ö—Ä–∞—Å–∞–≤—á–∏–∫ üí™");
    }

    function initTabs() {
        document.querySelectorAll(".tab-button").forEach(btn => {
            btn.addEventListener("click", () => {
                setActiveTab(btn.dataset.tab);
                if (btn.dataset.tab === "history") {
                    renderHistory();
                }
            });
        });
    }

    function initHandlers() {
        $("#today-workout-select").addEventListener("change", () => {
            renderTodayExercises();
        });

        $("#btn-save-today").addEventListener("click", () => {
            saveTodayWorkout();
        });

        $("#btn-add-workout").addEventListener("click", () => {
            const name = $("#new-workout-name").value;
            if (!name.trim()) {
                alert("–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.");
                return;
            }
            addWorkout(name);
            $("#new-workout-name").value = "";
        });

        $("#btn-add-exercise").addEventListener("click", () => {
            if (!state.workouts.length) {
                alert("–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π –ø—Ä–æ–≥—Ä–∞–º–º—É –≤—ã—à–µ.");
                return;
            }
            const workoutId = $("#exercise-workout-select").value;
            const name = $("#exercise-name").value;
            const sets = parseInt($("#exercise-sets").value, 10) || 1;
            const reps = parseInt($("#exercise-reps").value, 10) || 1;

            if (!name.trim()) {
                alert("–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.");
                return;
            }
            addExerciseToWorkout(workoutId, name, sets, reps);
            $("#exercise-name").value = "";
        });
    }

    function init() {
        loadState();
        $("#header-date").textContent = formatDateLabel(new Date());
        renderWorkoutSelects();
        renderTodayExercises();
        renderProgramsList();
        renderHistory();
        initTabs();
        initHandlers();
    }

    document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
